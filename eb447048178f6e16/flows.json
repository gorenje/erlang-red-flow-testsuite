[{"id":"eb447048178f6e16","type":"tab","label":"[.jsonata] ensure that $millis() works","disabled":false,"info":"$millis() is a NodeRED special that has special behaviour:\n\n> All invocations of $millis() within an evaluation of an expression will all return the same value.\n\nSo this test ensures that behaviour is covered.","env":[{"name":"ERED_PENDING","type":"bool","value":"false"}]},{"id":"66063e9bc81243c0","type":"inject","z":"eb447048178f6e16","name":"","props":[{"p":"same_millis","v":"$string($millis()) & \" \" & $string($pauseMillis(123)) & \" \" & $string($millis()) & \" \" & $string($pauseMillis(123)) & \" \" & $string($millis()) & \" \" & $string($pauseMillis(123)) & \" \" & $string($millis()) & \" \" & $string($pauseMillis(123)) & \" \" & $string($millis())","vt":"jsonata"},{"p":"different_millis","v":"$string($millis()) & \" \" & $string($pauseMillis(123))","vt":"jsonata"},{"p":"different_millis","v":"$$.different_millis & \" \" & $string($pauseMillis(321)) & \" \" & $string($millis()) ","vt":"jsonata"},{"p":"same_millis","v":"$string($$.same_millis)","vt":"jsonata"},{"p":"different_millis","v":"$string($$.different_millis)","vt":"jsonata"},{"p":"diffmillis","v":"$split($$.different_millis, \" \")","vt":"jsonata"},{"p":"diffmillis_first","v":"$$.diffmillis[0]","vt":"jsonata"},{"p":"diffmillis_last","v":"$$.diffmillis[-1]","vt":"jsonata"},{"p":"same_millis","v":"$split($$.same_millis, \" \")","vt":"jsonata"},{"p":"same_millis_first","v":"$$.same_millis[0]","vt":"jsonata"},{"p":"same_millis_last","v":"$$.same_millis[-1]","vt":"jsonata"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":221,"y":300,"wires":[["15597a4b8e27003f"]]},{"id":"15597a4b8e27003f","type":"ut-assert-values","z":"eb447048178f6e16","name":"","rules":[{"p":"diffmillis_first","pt":"msg","t":"noteql","to":"diffmillis_last","tot":"str"},{"p":"same_millis_first","pt":"msg","t":"eql","to":"same_millis_last","tot":"msg"}],"x":527,"y":141.5,"wires":[[]]},{"id":"6e4e7d888cabf325","type":"inject","z":"eb447048178f6e16","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{ \"key\": $millis() - $millis() }","payloadType":"jsonata","x":222,"y":410,"wires":[["11c4e9bc27404a44"]]},{"id":"11c4e9bc27404a44","type":"ut-assert-values","z":"eb447048178f6e16","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"{ \"key\": 0 }","tot":"json"}],"x":577,"y":362,"wires":[[]]},{"id":"e671799b9d0a12a2","type":"inject","z":"eb447048178f6e16","name":"","props":[{"p":"one","v":"$millis()","vt":"jsonata"},{"p":"pause","v":"$pauseMillis(123)","vt":"jsonata"},{"p":"two","v":"$millis()","vt":"jsonata"},{"p":"three","v":"$$.two - $$.one","vt":"jsonata"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":206,"y":521,"wires":[["fa35ed2cbb9afed3"]]},{"id":"fa35ed2cbb9afed3","type":"switch","z":"eb447048178f6e16","name":"","property":"three","propertyType":"msg","rules":[{"t":"gt","v":"122","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":361,"y":560.5,"wires":[["e645c4845d96bbd2"]]},{"id":"e645c4845d96bbd2","type":"ut-assert-success","z":"eb447048178f6e16","name":"","x":526,"y":509.5,"wires":[]}]