[{"id":"43e8af136f4d0fbe","type":"tab","label":"[.docu] link call Erlang architecture","disabled":false,"info":"<small><i>[Share link](https://flows.red-erik.org/f/43e8af136f4d0fbe)</i></small>\n\n## Link call node - dynamic target\n\nLink nodes connect different parts of flows together. They are the wormholes of flow based programming. These nodes emulate `goto` / `gosub` / `return` in other languages.\n\nThere are three nodes:\n\n- `link in` node defines a target point. It can be anywhere in a flow, connected to the input port of a node or multiple nodes.\n- `link call` re-routes an Erlang-Red message to a link-in node and waits until the message is returned to it. Once the Erlang-Red message comes back, the link-call node passes the message onto all nodes connected to it.\n- `link out` has two functions. The first function is to re-route Erlang-Red messages to specific link-in nodes. These are targets are static. The second function it has is to return Erlang-Red messages to link-call nodes. If a message arrives at a link-out node and it is marked as having come from a link-call node, then it is returned to that link-call node.\n\n## Flowcharts\n\nInitialisation\n\n```mermaid\n%% Generated by the Flow2UML Node @ https://flowhub.org/flow2uml\n%% change direction to LR for Node-RED left-to-right UML\ngraph RL\n96a8c3ef5146bfea@{ shape: \"st-rect\", label: \"system \\n &lt;ered_nodes.erl&gt;\" } -- \"handle_event#40;#123;registered#125;#41;#47;2\" --> 96e2e43870db30c7@{ shape: \"rect\", label: \"link in node \\n &lt;ered_node_link_in&gt;\" }\n96e2e43870db30c7@{ shape: \"rect\", label: \"link in node \\n &lt;ered_node_link_in&gt;\" } -- \"ered_link_node_exchange:register_link_in#47;3\" --> 66abe9b3d7951c38@{ shape: \"cyl\", label: \"ered_link_node_exchange \\n &lt;ered_link_node_exchange&gt;\" }\nsubgraph \"start up time\"\n96a8c3ef5146bfea\n96e2e43870db30c7\n66abe9b3d7951c38\nend\n```\n\nFor the <a class=\"ahl-group-only\" data-ids=\"dc1f1434a48fcc1a\">link call flow</a>:\n\n```mermaid\n%% Generated by the Flow2UML Node @ https://flowhub.org/flow2uml\n%% change direction to LR for Node-RED left-to-right UML\ngraph LR\n6ebebfbd704dfda2@{ shape: \"rect\", label: \"link out node \\n &lt;ered_node_link_out&gt;\" } -. \"**#40;11#41;** ! #123;link_return, Msg#125;\" .-> 8e133d66e6af0eed@{ shape: \"rect\", label: \"link call &lt;ered_node_link_call&gt;\" }\ne33d87ec3cc38aca@{ shape: \"rect\", label: \"ered_node_inject \\n &lt;ered_node&gt;\" } -. \"**#40;1#41;** ered_msg_handling:create_outgoing_msg#47;1\" .-> e6eab90d2828637c@{ shape: \"stadium\", label: \"#35;#123;Msg#125;\" }\ne6eab90d2828637c@{ shape: \"stadium\", label: \"#35;#123;Msg#125;\" } -. \"**#40;2#41;** #123;incoming, Msg#125;\" .-> 8e133d66e6af0eed@{ shape: \"rect\", label: \"link call &lt;ered_node_link_call&gt;\" }\n8e133d66e6af0eed@{ shape: \"rect\", label: \"link call &lt;ered_node_link_call&gt;\" } <-- \"**#40;3#41;** ered_link_node_exchange:obtain_link_node_pid#47;2\" --> 7a076cbf3b2b4e25@{ shape: \"cyl\", label: \"ered_link_node_exchange \\n &lt;ered_link_node_exchange&gt;\" }\n8e133d66e6af0eed@{ shape: \"rect\", label: \"link call &lt;ered_node_link_call&gt;\" } <-- \"**#40;4#41;** maps:put#40;'_link_source'#41;\" --> e6eab90d2828637c@{ shape: \"stadium\", label: \"#35;#123;Msg#125;\" }\n8e133d66e6af0eed@{ shape: \"rect\", label: \"link call &lt;ered_node_link_call&gt;\" } -. \"**#40;12#41;** ered_nodes:send_msg_to_connected_nodes#47;2\" .-> 3b1ca50e8775f40a@{ shape: \"rect\", label: \"debug 1 \\n &lt;ered_node_debug&gt;\" }\n8e133d66e6af0eed@{ shape: \"rect\", label: \"link call &lt;ered_node_link_call&gt;\" } -. \"**#40;5#41;** ered_nodes:send_msg_on_by_pids#47;2\" .-> 0403088d0d9bebe6@{ shape: \"rect\", label: \"link in node \\n &lt;ered_node_link_in&gt;\" }\nsubgraph \"link call flow\"\ne33d87ec3cc38aca\ne6eab90d2828637c\n8e133d66e6af0eed\n3b1ca50e8775f40a\nend\n```\n\n\n## Code\n\n- [ered_node_link_call.erl]()\n- [ered_node_link_in.erl]()\n- [ered_node_link_out.erl]()\n- [ered_link_node_exchange.erl]()\n\n\n","env":[]},{"id":"3a059b27f7145036","type":"group","z":"43e8af136f4d0fbe","name":"link in flow","style":{"label":true},"nodes":["62036c28fc6fd5af","20fc9c564df9c187","4d9422ed179e61b6"],"x":377,"y":388.5,"w":542,"h":83},{"id":"dc1f1434a48fcc1a","type":"group","z":"43e8af136f4d0fbe","name":"link call flow","style":{"label":true},"nodes":["878d585afede5275","f97d0c67ab746be4","d32e71dcb398fd64"],"x":341,"y":247.89285278320312,"w":643,"h":82},{"id":"878d585afede5275","type":"inject","z":"43e8af136f4d0fbe","g":"dc1f1434a48fcc1a","name":"","props":[{"p":"target","v":"fubar","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":437,"y":288.8928527832031,"wires":[["f97d0c67ab746be4"]]},{"id":"f97d0c67ab746be4","type":"link call","z":"43e8af136f4d0fbe","g":"dc1f1434a48fcc1a","name":"link call","links":[],"linkType":"dynamic","timeout":"30","x":631,"y":288.8928527832031,"wires":[["d32e71dcb398fd64"]]},{"id":"62036c28fc6fd5af","type":"link in","z":"43e8af136f4d0fbe","g":"3a059b27f7145036","name":"fubar","links":["9921e47955df4702"],"x":418,"y":430.5,"wires":[["20fc9c564df9c187"]]},{"id":"20fc9c564df9c187","type":"function","z":"43e8af136f4d0fbe","g":"3a059b27f7145036","name":"function 1","func":"%% Code here is wrapped in a fun (Msg) call\n%% fun (Msg) ->\n    Msg\n%% end.\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":652,"y":430.5,"wires":[["4d9422ed179e61b6"]]},{"id":"4d9422ed179e61b6","type":"link out","z":"43e8af136f4d0fbe","g":"3a059b27f7145036","name":"link out 1","mode":"link","links":[],"x":878,"y":429.5,"wires":[]},{"id":"d32e71dcb398fd64","type":"debug","z":"43e8af136f4d0fbe","g":"dc1f1434a48fcc1a","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":878,"y":288.8928527832031,"wires":[]}]