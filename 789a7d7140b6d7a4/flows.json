[{"disabled":false,"env":[{"name":"ERED_PENDING","type":"bool","value":"false"},{"name":"ERED_ONLY","type":"bool","value":"true"}],"id":"789a7d7140b6d7a4","info":"## Flow scanning\n\nScan all flow files for a particular node configuration.\n\nHere I'm looking for all assert success nodes that don't have a count value configured.\n\nOr debug nodes that shouldn't be included in tests.\n\nAnd also that node and flow IDs are universal unique.","label":"[.breadboard] scanning all flows for nodes","type":"tab"},{"h":158.763916015625,"id":"c24d7393f3f19c1d","name":"assert success nodes without a count value","nodes":["9c0a0ba9e5d3afde","0f1e64473122e326","464314c99f05a25e","c8e162f01da6ac87","44b621eadb210e77"],"style":{"label":true},"type":"group","w":1592.5555419921875,"x":1729.4444580078125,"y":463,"z":"789a7d7140b6d7a4"},{"h":161.21429443359375,"id":"4e16cab434a03538","name":"test flow contains debug nodes","nodes":["d5914cc889ef986f","39f35cb48838928e","0b13b4b3f7f1639b","c536ac07c18bc9e8","e93c8d8a186d4c51","a30ba0ff4c45734c"],"style":{"label":true},"type":"group","w":1335.888671875,"x":1774.111328125,"y":266,"z":"789a7d7140b6d7a4"},{"h":143.72098541259766,"id":"5d2c645572aec40d","name":"ensure node ids are universally unique across all test flows","nodes":["a2c736bf16117b1f","5642c0da1b81501d","6dc12dd49e304d82","d74ee77298140b11","a1cc98043e15865f","132e011b59fef855","bd829ce677ef7968"],"style":{"fill":"#e3f3d3","label":true},"type":"group","w":1624.111083984375,"x":1787.888916015625,"y":67.5,"z":"789a7d7140b6d7a4"},{"h":150.5,"id":"f6baad25357e36b0","name":"identify any duplicate node ids and show which flow contains duplicates","nodes":["c65853d3db6b6526","c4209c754c273a49","b0e69044412c8e8d","5f4103e0935465ed","f53d9e5e685e7e6b"],"style":{"label":true},"type":"group","w":1273,"x":1720,"y":678.5,"z":"789a7d7140b6d7a4"},{"h":127.5,"id":"0677f68c675af002","name":"ensure a limited set of flow environment variables are used","nodes":["4d88d822ba4efbcd","2d45fb644513ced0","e624ea3bd26f1cce","1a7a1da6221a05e1","96a4cbf26ce61f12"],"style":{"label":true},"type":"group","w":1119,"x":1651,"y":868,"z":"789a7d7140b6d7a4"},{"crontab":"","id":"5fe3d9322a13a03f","name":"set directory location","once":false,"onceDelay":0.1,"payload":"$privdir() & \"/testflows\"","payloadType":"jsonata","props":[{"p":"payload"}],"repeat":"","topic":"","type":"inject","wires":[["5f5cbf45df7cc40b"]],"x":200.71429443359375,"y":716,"z":"789a7d7140b6d7a4"},{"addpay":"payload","append":"","command":"ls","id":"5f5cbf45df7cc40b","name":"","oldrc":false,"timer":"","type":"exec","useSpawn":"false","winHide":false,"wires":[["49464c64ec47dbd2"],[],[]],"x":473,"y":716,"z":"789a7d7140b6d7a4"},{"addname":"","arraySplt":"17","arraySpltType":"len","id":"2d5a6c91a73e2d5a","name":"","property":"payload","splt":"\\n","spltType":"str","stream":false,"type":"split","wires":[["88c2518380e8fd3f"]],"x":777,"y":567.3973236083984,"z":"789a7d7140b6d7a4"},{"action":"","from":"","id":"88c2518380e8fd3f","name":"","property":"","reg":false,"rules":[{"p":"payload","pt":"msg","t":"set","to":"$trim($toString($$.payload))","tot":"jsonata"},{"p":"flowid","pt":"msg","t":"set","to":"payload","tot":"msg"}],"to":"","type":"change","wires":[["704d19a394f1debe"]],"x":1157.6666666666667,"y":567.3973236083984,"z":"789a7d7140b6d7a4"},{"checkall":"true","id":"704d19a394f1debe","name":"","outputs":1,"property":"$length($$.payload)","propertyType":"jsonata","repair":false,"rules":[{"t":"eq","v":"16","vt":"num"}],"type":"switch","wires":[["8d8bfb8384244635"]],"x":883,"y":424.4151611328125,"z":"789a7d7140b6d7a4"},{"action":"","from":"","id":"8d8bfb8384244635","name":"","property":"","reg":false,"rules":[{"p":"filename","pt":"msg","t":"set","to":"$toString($privdir() & \"/testflows/\" & $$.payload & \"/flows.json\")","tot":"jsonata"}],"to":"","type":"change","wires":[["933725060fcbed8d"]],"x":1068.3333333333335,"y":424.4151611328125,"z":"789a7d7140b6d7a4"},{"action":"","from":"","id":"49464c64ec47dbd2","name":"","property":"","reg":false,"rules":[{"p":"payload","pt":"msg","t":"set","to":"$trim($toList($$.payload))","tot":"jsonata"}],"to":"","type":"change","wires":[["2d5a6c91a73e2d5a"]],"x":1237,"y":702,"z":"789a7d7140b6d7a4"},{"allProps":false,"chunk":false,"encoding":"none","filename":"filename","filenameType":"msg","format":"utf8","id":"933725060fcbed8d","name":"","sendError":false,"type":"file in","wires":[["5718ae424030eda7"]],"x":999,"y":265.3125,"z":"789a7d7140b6d7a4"},{"action":"","id":"2d8649b52824e005","name":"","pretty":false,"property":"payload","type":"json","wires":[["9c0a0ba9e5d3afde","39f35cb48838928e","5642c0da1b81501d","c65853d3db6b6526","4d88d822ba4efbcd"]],"x":1588.4444580078125,"y":170.22098541259766,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ <<\"payload\">> := Payload } = Msg,\nMsg#{ \n      <<\"payload\">> => lists:filter( \n            fun( #{ <<\"type\">> := <<\"ut-assert-success\">>, <<\"count\">> := _Count } ) -> false; \n                ( #{ <<\"type\">> := <<\"ut-assert-success\">> } ) -> true; \n                (_) -> false end, \n            Payload) }\n","g":"c24d7393f3f19c1d","id":"9c0a0ba9e5d3afde","initialize":"","libs":[],"name":"filter on assert success nodes without count value","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["0f1e64473122e326"]],"x":1945.4444580078125,"y":580.763916015625,"z":"789a7d7140b6d7a4"},{"checkall":"true","g":"c24d7393f3f19c1d","id":"0f1e64473122e326","name":"payload contains at least one node?","outputs":1,"property":"$count($$.payload)","propertyType":"jsonata","repair":false,"rules":[{"t":"gt","v":"0","vt":"num"}],"type":"switch","wires":[["c8e162f01da6ac87"]],"x":2358.111083984375,"y":580.763916015625,"z":"789a7d7140b6d7a4"},{"action":"","from":"","id":"5718ae424030eda7","name":"","property":"","reg":false,"rules":[{"p":"original_file_contents","pt":"msg","t":"set","to":"payload","tot":"msg"},{"p":"autoimport","pt":"msg","t":"set","to":"true","tot":"bool"}],"to":"","type":"change","wires":[["2d8649b52824e005"]],"x":1309,"y":170.22098541259766,"z":"789a7d7140b6d7a4"},{"clientcode":"function doIt() {\n  var content = msg.original_file_contents;\n\n  if (content.length == 0) {\n    RED.notify(\"No new content\", {\n      type: \"ok\",\n      id: \"TriggerImport\",\n      timeout: 2000\n    });\n    return;\n  }\n  RED.clipboard.import();\n\n  setTimeout(() => {\n    $('#red-ui-clipboard-dialog-import-text').val(\n      content\n    ).trigger(\"paste\");\n\n    if (msg.autoimport) {\n      setTimeout(() => {\n        $('#red-ui-clipboard-dialog-ok').trigger('click');\n        node.send({ payload: \"ok\"})\n      }, 435);\n    } else {\n      node.send({ payload: \"ok\" })\n    }\n  }, 300);\n};\n\ndoIt();\n","d":true,"format":"javascript","g":"c24d7393f3f19c1d","id":"464314c99f05a25e","name":"TriggerImport","type":"ClientCode","wires":[[]],"x":3013.4443359375,"y":580.763916015625,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ '_mc_incoming' := MsgCount } = NodeDef,\n\ncase MsgCount of \n    1 ->\n        Msg;\n    _ ->\n        undefined\nend\n","g":"c24d7393f3f19c1d","id":"c8e162f01da6ac87","initialize":"","libs":[],"name":"pass through only the first message","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["464314c99f05a25e","44b621eadb210e77"]],"x":2720.7777099609375,"y":580.763916015625,"z":"789a7d7140b6d7a4"},{"active":false,"complete":"parts.index","console":false,"g":"4e16cab434a03538","id":"d5914cc889ef986f","name":"debug 1","statusType":"counter","statusVal":"","targetType":"msg","tosidebar":false,"tostatus":true,"type":"debug","wires":[],"x":2485.111328125,"y":317.21429443359375,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ <<\"payload\">> := Payload } = Msg,\nMsg#{ \n      <<\"payload\">> => lists:filter( \n            fun( #{ <<\"type\">> := <<\"debug\">>, <<\"active\">> := false }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"182731f54d855071\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"1fd621a674360b5d\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"211405fa9e8a6f9b\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"43e8af136f4d0fbe\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"3d6a5582d9779194\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"3afa3b2ec00a5e3d\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"5a06352874fa379d\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"684b9066e98b9722\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"6f0dcbf18234c5e2\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"6ff45e2a0ce77393\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"700c94899fdd3334\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"789a7d7140b6d7a4\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"6b22ce2a482c2d6d\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"79d0839cd7b4061d\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"7fea9696f6186962\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"84a5a362cafe703f\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"83c5e1824f32abec\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"af57984ed3302e3e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"a916165378c446e3\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"a6dc7002d0a8640e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"b2a67e301fabab0e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"b723353a316fa50e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"9a1bdfdcd7b2be8e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"e447b0048a5983b5\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"dc897f402c53697f\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"c0b1cf6656eac77f\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"b1463d7bbf545725\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"db3426b96377ec6e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"30a121650c89fce3\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"ac9f69e018b6cbfc\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"72fbf0bdf8eacc7e\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"9576156cd207e309\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"2a0abc9d995a9136\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"07452607645aeeb7\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"5a6943e6091753b6\">> }) -> false;\n               %% ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"\">> }) -> false;\n               %% ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"\">> }) -> false;\n               %% ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"\">> }) -> false;\n               %% ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"\">> }) -> false;\n               %% ( #{ <<\"type\">> := <<\"debug\">>, <<\"z\">> := <<\"\">> }) -> false;\n               ( #{ <<\"type\">> := <<\"debug\">> } ) -> true; \n               (_) -> false end, \n            Payload) }\n\n\n","g":"4e16cab434a03538","id":"39f35cb48838928e","initialize":"","libs":[],"name":"filter on debug nodes","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["0b13b4b3f7f1639b"]],"x":1900.111328125,"y":386.21429443359375,"z":"789a7d7140b6d7a4"},{"checkall":"true","g":"4e16cab434a03538","id":"0b13b4b3f7f1639b","name":"payload contains at least one node?","outputs":1,"property":"$count($$.payload)","propertyType":"jsonata","repair":false,"rules":[{"t":"gt","v":"0","vt":"num"}],"type":"switch","wires":[["d5914cc889ef986f","e93c8d8a186d4c51"]],"x":2220.111328125,"y":386.21429443359375,"z":"789a7d7140b6d7a4"},{"clientcode":"function doIt() {\n  var content = msg.original_file_contents;\n\n  if (content.length == 0) {\n    RED.notify(\"No new content\", {\n      type: \"ok\",\n      id: \"TriggerImport\",\n      timeout: 2000\n    });\n    return;\n  }\n  RED.clipboard.import();\n\n  setTimeout(() => {\n    $('#red-ui-clipboard-dialog-import-text').val(\n      content\n    ).trigger(\"paste\");\n\n    if (msg.autoimport) {\n      setTimeout(() => {\n        $('#red-ui-clipboard-dialog-ok').trigger('click');\n        node.send({ payload: \"ok\"})\n      }, 435);\n    } else {\n      node.send({ payload: \"ok\" })\n    }\n  }, 300);\n};\n\ndoIt();\n","d":true,"format":"javascript","g":"4e16cab434a03538","id":"c536ac07c18bc9e8","name":"TriggerImport","type":"ClientCode","wires":[[]],"x":2870.111328125,"y":386.21429443359375,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ '_mc_incoming' := MsgCount } = NodeDef,\n\ncase MsgCount of \n    1 ->\n        Msg;\n    _ ->\n        undefined\nend\n","g":"4e16cab434a03538","id":"e93c8d8a186d4c51","initialize":"","libs":[],"name":"pass through only the first message","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["c536ac07c18bc9e8","a30ba0ff4c45734c"]],"x":2580.111328125,"y":386.21429443359375,"z":"789a7d7140b6d7a4"},{"accumulate":"false","build":"object","count":"","g":"5d2c645572aec40d","id":"a2c736bf16117b1f","joiner":"\\n","joinerType":"str","key":"topic","mode":"auto","name":"","property":"payload","propertyType":"msg","reduceRight":false,"timeout":"","type":"join","useparts":false,"wires":[["6dc12dd49e304d82"]],"x":2154.888916015625,"y":170.22098541259766,"z":"789a7d7140b6d7a4"},{"action":"","from":"","g":"5d2c645572aec40d","id":"5642c0da1b81501d","name":"","property":"","reg":false,"rules":[{"p":"payload","pt":"msg","t":"set","to":"$map($$.payload, function($v) { $v.id } )","tot":"jsonata"},{"p":"original_file_contents","pt":"msg","t":"delete"}],"to":"","type":"change","wires":[["a2c736bf16117b1f"]],"x":1893.888916015625,"y":170.22098541259766,"z":"789a7d7140b6d7a4"},{"action":"","from":"","g":"5d2c645572aec40d","id":"6dc12dd49e304d82","name":"","property":"","reg":false,"rules":[{"p":"non_distinct_length","pt":"msg","t":"set","to":"$count($sort($flatten($$.payload)))","tot":"jsonata"},{"p":"distinct_length","pt":"msg","t":"set","to":"$count($distinct($flatten($$.payload)))","tot":"jsonata"}],"to":"","type":"change","wires":[["d74ee77298140b11","a1cc98043e15865f"]],"x":2440.888916015625,"y":170.22098541259766,"z":"789a7d7140b6d7a4"},{"g":"5d2c645572aec40d","id":"d74ee77298140b11","ignore_failure_if_succeed":false,"name":"length of distinct ids equal to length of ids","rules":[{"p":"non_distinct_length","pt":"msg","t":"eql","to":"distinct_length","tot":"msg"}],"type":"ut-assert-values","wires":[[]],"x":2826.888916015625,"y":170.22098541259766,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ <<\"payload\">> := Payload, \n   <<\"flowid\">> := FlowId } = Msg, \n\nMsg#{ <<\"payload\">> => {FlowId, lists:map( fun(#{<<\"id\">> := Id}) -> Id end, Payload)} }\n\n","g":"f6baad25357e36b0","id":"c65853d3db6b6526","initialize":"","libs":[],"name":"payload becomes tuple with flow id and node ids","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["c4209c754c273a49"]],"x":1936,"y":788,"z":"789a7d7140b6d7a4"},{"accumulate":true,"build":"object","count":"","g":"f6baad25357e36b0","id":"c4209c754c273a49","joiner":"\\n","joinerType":"str","key":"topic","mode":"auto","name":"","property":"payload","propertyType":"msg","reduceExp":"","reduceFixup":"","reduceInit":"","reduceInitType":"","reduceRight":false,"timeout":"","type":"join","useparts":false,"wires":[["b0e69044412c8e8d"]],"x":2247.75,"y":788,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ <<\"payload\">> := Payload } = Msg, \nMsg#{ <<\"payload\">> => helpers_scanids:find_duplicates(Payload,#{}) }\n","g":"f6baad25357e36b0","id":"b0e69044412c8e8d","initialize":"","libs":[],"name":"identify duplicate node ids","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["f53d9e5e685e7e6b"]],"x":2489.5,"y":788,"z":"789a7d7140b6d7a4"},{"code":"-module(helpers_scanids).\n\n-export([\n   find_duplicates/2\n]).\n\nfind_duplicates([], Stack) -> \n   duplicates(maps:to_list(Stack),[]);\n\nfind_duplicates([{_FlowId, []} | Rest], Stack) ->\n   find_duplicates(Rest, Stack);\n\nfind_duplicates([{FlowId, [NodeId | NodeIds]} | Rest], Stack) ->\n    Stack2 =\n        case maps:find(NodeId, Stack) of\n            {ok, Val} ->\n                Stack#{NodeId => [FlowId | Val]};\n            _ ->\n                Stack#{NodeId => [FlowId]}\n        end,\n    find_duplicates([{FlowId, NodeIds}|Rest], Stack2).\n\n\nis_duplicate({_, [_SingleFileName | []]}) ->\n    false;\nis_duplicate({_, _}) ->\n    true.\n\nduplicates([], Acc) ->\n    Acc;\nduplicates([H | T], Acc) ->\n    case is_duplicate(H) of\n        true -> duplicates(T, [H | Acc]);\n        _ -> duplicates(T, Acc)\n    end.\n\n","g":"f6baad25357e36b0","id":"5f4103e0935465ed","module_name":"helpers_scanids","name":"","type":"erlmodule","wires":[],"x":1956,"y":721.5,"z":"789a7d7140b6d7a4"},{"g":"f6baad25357e36b0","id":"f53d9e5e685e7e6b","ignore_failure_if_succeed":false,"name":"list of duplications should be empty","rules":[{"p":"payload","pt":"msg","t":"eql","to":"[]","tot":"json"}],"type":"ut-assert-values","wires":[[]],"x":2827,"y":719.5,"z":"789a7d7140b6d7a4"},{"action":"","from":"","g":"5d2c645572aec40d","id":"a1cc98043e15865f","name":"count payload => num of test flows","property":"","reg":false,"rules":[{"p":"payload","pt":"msg","t":"set","to":"$count($$.payload)","tot":"jsonata"}],"to":"","type":"change","wires":[["132e011b59fef855"]],"x":2711,"y":108.5,"z":"789a7d7140b6d7a4"},{"checkall":"true","g":"5d2c645572aec40d","id":"132e011b59fef855","name":"atleast 243 flows","outputs":1,"property":"payload","propertyType":"msg","repair":false,"rules":[{"t":"gt","v":"243","vt":"num"}],"type":"switch","wires":[["bd829ce677ef7968"]],"x":3048.5,"y":108.5,"z":"789a7d7140b6d7a4"},{"count":1,"g":"5d2c645572aec40d","id":"bd829ce677ef7968","name":"","type":"ut-assert-success","wires":[],"x":3316,"y":108.5,"z":"789a7d7140b6d7a4"},{"g":"4e16cab434a03538","id":"a30ba0ff4c45734c","name":"test flows should not have debug nodes","type":"ut-assert-failure","wires":[],"x":2924,"y":307,"z":"789a7d7140b6d7a4"},{"g":"c24d7393f3f19c1d","id":"44b621eadb210e77","name":"assert success with without count attribute","type":"ut-assert-failure","wires":[],"x":3126,"y":504,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ <<\"payload\">> := Payload } = Msg,\nPayload2 =lists:filter( \n                fun( [_A|_T] ) -> true; \n                    (_) -> false end, \n            lists:map( fun( #{ <<\"env\">> := Env }) -> Env;\n                      (_) -> undefined end,\n                lists:filter( \n                    fun( #{ <<\"type\">> := <<\"tab\">> } ) -> true; \n                        (_) -> false end, \n                    Payload) \n        )\n    ),\n\ncase length(Payload2) of \n    0 ->\n        Msg#{ <<\"payload\">> => [] };\n    _ ->\n        Msg#{ <<\"payload\">> => lists:map(fun ( #{ <<\"name\">> := Name} )-> Name end, lists:nth(1,Payload2)) }\nend\n","g":"0677f68c675af002","id":"4d88d822ba4efbcd","initialize":"","libs":[],"name":"filter on tabs return the ENV values","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["2d45fb644513ced0"]],"x":1817,"y":954.5,"z":"789a7d7140b6d7a4"},{"accumulate":true,"build":"object","count":"","g":"0677f68c675af002","id":"2d45fb644513ced0","joiner":"\\n","joinerType":"str","key":"topic","mode":"auto","name":"","property":"payload","propertyType":"msg","reduceExp":"","reduceFixup":"","reduceInit":"","reduceInitType":"","reduceRight":false,"timeout":"","type":"join","useparts":false,"wires":[["e624ea3bd26f1cce"]],"x":2059.333333333333,"y":954.5,"z":"789a7d7140b6d7a4"},{"action":"","from":"","g":"0677f68c675af002","id":"e624ea3bd26f1cce","name":"","property":"","reg":false,"rules":[{"p":"payload","pt":"msg","t":"set","to":"$distinct($flatten($$.payload))","tot":"jsonata"}],"to":"","type":"change","wires":[["1a7a1da6221a05e1"]],"x":2241.6666666666665,"y":954.5,"z":"789a7d7140b6d7a4"},{"finalize":"","func":"#{ <<\"payload\">> := Payload } = Msg,\nMsg#{ <<\"payload\">> => lists:sort(fun ( A,B ) -> A > B end, Payload) }\n","g":"0677f68c675af002","id":"1a7a1da6221a05e1","initialize":"","libs":[],"name":"sort payload","noerr":0,"outputs":1,"timeout":0,"type":"function","wires":[["96a4cbf26ce61f12"]],"x":2444,"y":954.5,"z":"789a7d7140b6d7a4"},{"g":"0677f68c675af002","id":"96a4cbf26ce61f12","ignore_failure_if_succeed":false,"name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"[\"NODE_RED_DIVERGENT\",\"ERED_TIMEOUT\",\"ERED_PENDING\",\"ERED_ONLY\",\"ERED_NOT_EUNIT\",\"ERED_KEEPRUNNING\"]","tot":"json"}],"type":"ut-assert-values","wires":[[]],"x":2654,"y":909,"z":"789a7d7140b6d7a4"}]