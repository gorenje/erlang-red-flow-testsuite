[{"id":"b70a7ce34819e4d5","type":"tab","label":"[eventhandler] register and unregister handler","disabled":false,"info":"## gen_event behaviour\n\nSimple example of defining a module that should act as an event handler. That handler is added and removed with no errors.\n\nThis demonstrates the implementation of the the [`gen_event`](https://www.erlang.org/doc/apps/stdlib/gen_event.html) behaviour in Erlang-Red. It does this by defining a module that handles the events. As many modules and handlers as necessary can be defined.\n\n## Setup \n\nFirst a <a class=\"ahl-node-only\" data-ids=\"c8e7ba1933cfcb5e\">event_handler_fubar</a> module is defined for handling events sent to the <a class=\"ahl-node-only\" data-ids=\"d405249f794935df\">Event Handler</a>. The handler defined in the module is dynamically assigned to the event handler via the <a class=\"ahl-node-only\" data-ids=\"24782c393c37989e\">add handler event_handler_test_one</a> action.\n\nThe module is defined when the flow is loaded, the event handler is added once the flow begins execution in Erlang-Red. So even though the module is defined here, it is loaded before the flow begins execution.\n\nHaving installed the module as a handler, an <a class=\"ahl-node-only\" data-ids=\"51cbf6af1bd46765\">event of type fubar</a> is generated to ensure the handler is triggered. After the event has been handled, the handler is removed by a <a class=\"ahl-node-only\" data-ids=\"6132faf9b79f6e70\">remove handler event_handler_test_one</a> message.\n\n## This is a flow test\n\nBecause this is a flow test, the <a class=\"ahl-node-only\" data-ids=\"a23baf5ca441fb84,cc49a4fb11fcfa3d\">delay nodes</a> have been added. The <a class=\"ahl-group-only\" data-ids=\"3f3cadcfb6b74656\">assert nodes</a> ensure the test is working.\n\nDuring the testing, all <a class=\"ahl-node-only\" data-ids=\"51cbf6af1bd46765,24782c393c37989e,6132faf9b79f6e70\">inject nodes</a> are triggered at once, therefore the delays ensure a specific order of messages.\n\n## Other behaviours\n\n- [Supervisor](https://flows.red-erik.org/f/83c5e1824f32abec)\n- [State machine](https://flows.red-erik.org/f/5672fa442b2b881d)","env":[]},{"id":"3f3cadcfb6b74656","type":"group","z":"b70a7ce34819e4d5","name":"testing","style":{"label":true},"nodes":["f105487f788cf599","3a49427b35876cbe","f3f1c7b1c3c98be3","a3a511b352d9a0d1","0710186488e3cafb"],"x":826,"y":468.5,"w":584,"h":231.5},{"id":"d405249f794935df","type":"erleventhandler","z":"b70a7ce34819e4d5","name":"","x":627,"y":381.75,"wires":[["2863a3a6aff60cc2","f105487f788cf599"]]},{"id":"51cbf6af1bd46765","type":"inject","z":"b70a7ce34819e4d5","name":"event_type_fubar","props":[{"p":"payload"},{"p":"event","v":"event_type_fubar","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":351,"y":400,"wires":[["a23baf5ca441fb84"]]},{"id":"c8e7ba1933cfcb5e","type":"erlmodule","z":"b70a7ce34819e4d5","name":"event_handler_fubar","module_name":"event_handler_fubar","code":"-module(event_handler_fubar).\n\n-behaviour(gen_event).\n\n-export([\n    init/1,\n    handle_event/2,\n    handle_call/2,\n    handle_info/2,\n    terminate/2,\n    code_change/3\n]).\n\n-import(ered_nodes, [\n    send_msg_to_connected_nodes/2\n]).\n\n-import(ered_msgtracer_helpers, [\n    send_off_debug/2\n]).\n\ninit(Args) ->\n    {ok, Args}.\n\nhandle_event({<<\"event_type_fubar\">>, Msg, NodeDef}, State) ->\n    Msg2 = Msg#{ handled => <<\"Fubar Event\">> },\n    send_msg_to_connected_nodes(NodeDef, Msg2),\n    {ok, State};\n\nhandle_event(_Event, State) ->\n    {ok, State}.\n\nhandle_call(_Request, State) ->\n    {ok, ok, State}.\n\nhandle_info(_Info, State) ->\n    {ok, State}.\n\nterminate(_Reason, _State) ->\n    ok.\n\ncode_change(_OldVsn, State, _Extra) ->\n    {ok, State}.\n","x":624,"y":282,"wires":[[]]},{"id":"24782c393c37989e","type":"inject","z":"b70a7ce34819e4d5","name":"add handler event_handler_test_one","props":[{"p":"action","v":"add_handler","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"event_handler_fubar","payloadType":"str","x":303,"y":312,"wires":[["d405249f794935df"]]},{"id":"2863a3a6aff60cc2","type":"debug","z":"b70a7ce34819e4d5","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1332,"y":381.75,"wires":[]},{"id":"6132faf9b79f6e70","type":"inject","z":"b70a7ce34819e4d5","name":"remove handler event_handler_test_one","props":[{"p":"action","v":"delete_handler","vt":"str"},{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"event_handler_fubar","payloadType":"str","x":329,"y":626.75,"wires":[["cc49a4fb11fcfa3d"]]},{"id":"f105487f788cf599","type":"switch","z":"b70a7ce34819e4d5","g":"3f3cadcfb6b74656","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"add_handler","vt":"str"},{"t":"eq","v":"delete_handler","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":902,"y":583,"wires":[["3a49427b35876cbe"],["f3f1c7b1c3c98be3"],["a3a511b352d9a0d1"]]},{"id":"a23baf5ca441fb84","type":"delay","z":"b70a7ce34819e4d5","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":361,"y":461,"wires":[["d405249f794935df"]]},{"id":"cc49a4fb11fcfa3d","type":"delay","z":"b70a7ce34819e4d5","name":"","pauseType":"delay","timeout":"750","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":409,"y":572,"wires":[["d405249f794935df"]]},{"id":"3a49427b35876cbe","type":"ut-assert-values","z":"b70a7ce34819e4d5","g":"3f3cadcfb6b74656","name":"","rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":1193,"y":509.5,"wires":[[]]},{"id":"f3f1c7b1c3c98be3","type":"ut-assert-values","z":"b70a7ce34819e4d5","g":"3f3cadcfb6b74656","name":"","rules":[{"t":"eql","p":"payload","pt":"msg","to":"ok","tot":"str"}],"x":1244,"y":583,"wires":[[]]},{"id":"a3a511b352d9a0d1","type":"switch","z":"b70a7ce34819e4d5","g":"3f3cadcfb6b74656","name":"","property":"event","propertyType":"msg","rules":[{"t":"eq","v":"event_type_fubar","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1068,"y":659,"wires":[["0710186488e3cafb"]]},{"id":"0710186488e3cafb","type":"ut-assert-values","z":"b70a7ce34819e4d5","g":"3f3cadcfb6b74656","name":"","rules":[{"t":"eql","p":"handled","pt":"msg","to":"Fubar Event","tot":"str"}],"x":1294,"y":659,"wires":[[]]}]