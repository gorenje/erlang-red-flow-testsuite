[{"id":"2037454a5ee0d6c3","type":"tab","label":"[.jsonata] basic support for JSONata","disabled":false,"info":"[JSONata](https://jsonata.org/) is very heaviliy embedded in Node-RED and provides a good service for minor manipulations of the Msg object.\n\nIts usage is mainly to avoid adding a function node with one line of code - because that is often all that is needed.\n\nIn a visual, low-code environment, the use of the function node is actually a code smell.\n\nJSONata is feature reach and far to complex to implement in two days. So the current implementation - at the time of writing - provides a very minor subset of what JSONata can do.\n\n**Note**: This test should succeed on any good Node-RED installation. The JSONata found here is conform to NodeRED. ","env":[]},{"id":"17cbd1a244fbf2ac","type":"group","z":"2037454a5ee0d6c3","name":"JSONata helper","style":{"label":true},"nodes":["4568c7342aebcd4e","28b0c3032848539f","e3e1beeda4a654d4"],"x":317,"y":1066,"w":900,"h":82},{"id":"16c6db7364c11bd1","type":"inject","z":"2037454a5ee0d6c3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":178,"y":435,"wires":[["b10c774a078c8d82","ecda6b9ee4d85f55","322f657814dce9a8","b33602daf0e3cd49","6bef0f3799844495","f0ed8b486d73e527","c1a3e98c8f2f0d74","bffd63842f46fad3"]]},{"id":"b10c774a078c8d82","type":"change","z":"2037454a5ee0d6c3","name":"map creation with comments ","rules":[{"p":"payload","pt":"msg","t":"set","to":"world","tot":"str"},{"p":"map","pt":"msg","t":"set","to":"/* comment one */ \t{\t    \"key\": \"hello \" & $$.payload\t}  \t/* comment two */","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":206,"wires":[["5ce29a3137ffb466"]]},{"id":"5ce29a3137ffb466","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"map.key","pt":"msg","t":"eql","to":"hello world","tot":"str"}],"x":1032,"y":206,"wires":[[]]},{"id":"ecda6b9ee4d85f55","type":"change","z":"2037454a5ee0d6c3","name":"simple string","rules":[{"p":"payload","pt":"msg","t":"set","to":"\"hello world\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":279,"wires":[["4a3ee103aa7083ab"]]},{"id":"99e6d72cb8c633a9","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"hello world","tot":"str"}],"x":1032,"y":279,"wires":[[]]},{"id":"322f657814dce9a8","type":"change","z":"2037454a5ee0d6c3","name":"replace stuff","rules":[{"p":"payload","pt":"msg","t":"set","to":"\"hello world\"","tot":"jsonata"},{"p":"payload","pt":"msg","t":"set","to":"$replace($$.payload, \"hello\", \"goodbye cruel\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":377,"wires":[["d9bd2d0f0f9d1de9"]]},{"id":"d9bd2d0f0f9d1de9","type":"link call","z":"2037454a5ee0d6c3","name":"","links":["4568c7342aebcd4e"],"linkType":"static","timeout":"30","x":751,"y":377,"wires":[["9b73d830d29d1c7b"]]},{"id":"4568c7342aebcd4e","type":"link in","z":"2037454a5ee0d6c3","g":"17cbd1a244fbf2ac","name":"convert payload to string","links":[],"x":358,"y":1107,"wires":[["28b0c3032848539f"]]},{"id":"28b0c3032848539f","type":"change","z":"2037454a5ee0d6c3","g":"17cbd1a244fbf2ac","name":"$string($$.payload) - convert lists to binary that are represented as strings in the flow editor","rules":[{"p":"payload","pt":"msg","t":"set","to":"$string($$.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":1107,"wires":[["e3e1beeda4a654d4"]],"info":"necessary because JSONata does things in lists while ErlangRED does things in binary."},{"id":"e3e1beeda4a654d4","type":"link out","z":"2037454a5ee0d6c3","g":"17cbd1a244fbf2ac","name":"link out 1","mode":"return","links":[],"x":1176,"y":1107,"wires":[]},{"id":"9b73d830d29d1c7b","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"goodbye cruel world","tot":"str"}],"x":1032,"y":377,"wires":[[]]},{"id":"4a3ee103aa7083ab","type":"link call","z":"2037454a5ee0d6c3","name":"","links":["4568c7342aebcd4e"],"linkType":"static","timeout":"30","x":751,"y":279,"wires":[["99e6d72cb8c633a9"]]},{"id":"b33602daf0e3cd49","type":"change","z":"2037454a5ee0d6c3","name":"count array lengths","rules":[{"p":"payload","pt":"msg","t":"set","to":"[1,2,3,4,5,6,7,8,9,10,11,12,13,14]","tot":"json"},{"p":"payload","pt":"msg","t":"set","to":"$count($$.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":480,"wires":[["0bcaf5273f0c6c65"]]},{"id":"0bcaf5273f0c6c65","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"14","tot":"num"}],"x":1032,"y":480,"wires":[[]]},{"id":"6bef0f3799844495","type":"change","z":"2037454a5ee0d6c3","name":"concat strings with nesting","rules":[{"p":"payload","pt":"msg","t":"set","to":"{\"key\":{\"key2\":{\"key3\":\"3\",\"key_int\":10},\"float\":123.121,\"string\":\"sdsadsa\"}}","tot":"json"},{"p":"payload","pt":"msg","t":"set","to":"$$.payload.key.float & $$.payload.key.string & $$.payload.key.key2.key3 & $$.payload.key.key2.key_int","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":576,"wires":[["35836bbc4bc5bc5f"]]},{"id":"35836bbc4bc5bc5f","type":"link call","z":"2037454a5ee0d6c3","name":"","links":["4568c7342aebcd4e"],"linkType":"static","timeout":"30","x":751,"y":576,"wires":[["5cb1c21b7ea453dc"]]},{"id":"5cb1c21b7ea453dc","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"123.121sdsadsa310","tot":"str"}],"x":1032,"y":576,"wires":[[]]},{"id":"f0ed8b486d73e527","type":"change","z":"2037454a5ee0d6c3","name":"underscored key names","rules":[{"p":"payload","pt":"msg","t":"set","to":"{\"_key\":{\"_key2\":{\"_key3\":3}}}","tot":"json"},{"p":"payload","pt":"msg","t":"set","to":"$$.payload._key._key2._key3","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":655,"wires":[["ba768d4eec826516"]]},{"id":"ba768d4eec826516","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"3","tot":"num"}],"x":1032,"y":655,"wires":[[]]},{"id":"c1a3e98c8f2f0d74","type":"change","z":"2037454a5ee0d6c3","name":"algorithmic","rules":[{"p":"payload","pt":"msg","t":"set","to":"8","tot":"json"},{"p":"payload","pt":"msg","t":"set","to":"$$.payload * 5","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":732,"wires":[["56eebfb308528a48"]]},{"id":"56eebfb308528a48","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"40","tot":"num"}],"x":1032,"y":732,"wires":[[]]},{"id":"7c4296694d030e62","type":"change","z":"2037454a5ee0d6c3","name":"increment","rules":[{"p":"payload","pt":"msg","t":"set","to":"$$.payload + 1","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":759,"y":770,"wires":[["722187872e77aaf0"]]},{"id":"722187872e77aaf0","type":"switch","z":"2037454a5ee0d6c3","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"100","vt":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":765,"y":913,"wires":[["7c4296694d030e62"],["42c649e5e087759b"]]},{"id":"42c649e5e087759b","type":"ut-assert-values","z":"2037454a5ee0d6c3","name":"","rules":[{"p":"payload","pt":"msg","t":"eql","to":"100","tot":"num"}],"x":1032,"y":842.5,"wires":[[]]},{"id":"bffd63842f46fad3","type":"change","z":"2037454a5ee0d6c3","name":"start value","rules":[{"p":"payload","pt":"msg","t":"set","to":"8","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.5,"y":842.5,"wires":[["7c4296694d030e62"]]}]